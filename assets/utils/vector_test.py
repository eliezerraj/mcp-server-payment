"""

    # test
    SELECT 
        message,
        1 - (vector_data <=> '[-0.06538654,0.016056776,0.0033111444,-0.004985376,-0.007173379,0.023472982,0.06651939,-0.028610893,-0.037977774,-0.08266972,0.0023294503,0.06473525,0.009347068,-0.024065992,-0.00065333373,0.023614077,-0.004805428,0.017823026,-0.016602242,0.027328571,0.01987709,0.070600934,-0.015088532,0.02313609,-0.06715432,-0.029583033,-0.0042614946,0.022958187,0.020644937,-0.00045239396,0.09549766,0.055941317,0.014837526,-0.0035476463,0.020646982,0.019987065,0.0045723137,0.07632399,-0.031115657,-0.027166003,0.018887378,-0.004604009,-0.0008137915,0.00436476,0.014791517,0.0419064,0.08191721,0.076178044,0.01967874,0.033142116,0.035204362,3.636022e-05,-0.017982077,0.05356723,-0.05235258,0.0043657827,0.03514915,0.06443261,-0.021074357,0.07392793,-0.036048763,0.02186163,0.0058171717,0.011353079,0.033682983,-0.04926075,-0.022585,0.014189304,-0.012330524,0.03247958,0.017471308,0.0040242905,-0.029812057,-0.01577305,-0.040796038,0.0062802853,0.013680133,-0.00012882636,0.02110452,0.045347907,-0.0051731197,0.01571886,-0.034541827,0.07897261,0.034036744,-0.057912566,0.054453038,0.00019886292,-0.0035726312,-0.009441133,0.08643635,0.0031319633,0.039805304,0.038600877,0.043465354,-0.0988773,-0.0189477,-0.047838546,-0.011194602,-0.017157422,0.05338115,0.016278131,0.04405223,0.0049362993,-0.036950674,0.04210373,-0.038128514,0.025677344,0.03346316,0.06378336,0.0057010776,-0.027898066,-0.057618104,0.03757947,-0.030977627,0.015672851,0.056334697,-0.046561528,0.047815543,-0.007868633,0.034197263,-0.01435187,-0.011897779,0.036514096,0.06596779,0.024857953,0.02620185,-0.048469387,-0.012298317,-0.035274398,-0.022684686,0.010436725,-0.042302083,0.02745024,-0.04371063,-0.011526381,-0.04283681,8.179452e-05,-0.013541593,0.001293887,0.0046479735,-0.013832475,0.024697855,-0.019291237,0.039261367,-0.027327549,-0.02134888,-0.04830273,0.0060415473,0.064708665,0.0036859615,0.03177717,0.03234564,0.015847687,-0.0109600825,0.021206763,0.07147333,-0.0018048472,-0.037328973,0.020450419,0.016380055,0.0012685818,0.035930287,0.014548178,-0.003265646,-0.0006272617,-0.024221402,-0.041841988,-0.013333529,-0.055411696,-0.030629491,0.07191528,-0.0036153176,0.041524105,0.023798114,-0.018522369,-0.020485949,-0.0724638,-0.06282228,-0.024358407,-0.00501525,0.024656959,-0.038067166,-0.013592204,0.016379353,-0.04191765,-0.068061605,-0.030175276,0.0036265645,-0.0015561407,-0.02516715,0.0013306946,0.014659623,0.044357166,0.007244949,0.010267768,-0.064073734,-0.05432383,-0.053233918,0.009081237,-0.003997196,-0.009079192,-0.014266241,0.00036194074,0.007895215,0.0020407732,-0.027222237,-0.016781168,-0.017159468,0.056401413,0.027885795,-0.034769952,-0.0024180503,-0.017920667,-0.0070486427,0.011133735,-0.02086936,-0.017286856,0.023610499,-0.05414235,0.061955255,0.086166434,0.009059765,-0.0030008364,0.015947886,0.0021338144,0.019681294,-0.011025901,0.029576898,0.013922449,0.0070242323,0.008991262,-0.03589348,0.038784914,-0.045185972,0.009208018,0.008590469,-0.006997521,0.00015234228,0.012837649,0.040197916,-0.058683477,0.006908442,-0.004664332,-0.023765398,-0.01905825,0.015933571,0.0023871218,-0.0513005,-0.099981524,0.036230113,0.03219841,0.02504037,-0.005128516,-0.012477754,-0.0006589571,0.0159121,0.019621482,-0.012741541,-0.01638063,-0.046802823,0.013276273,0.044658784,-0.022575287,0.00020244143,0.03440533,-0.0012381645,-0.013527791,-0.007561903,-0.022627432,-0.054353222,0.01104405,-0.0015227839,0.038803317,-0.010710481,-0.0048258766,0.0030816083,-0.06585277,-0.0095086135,-0.036425143,-0.045925576,0.033347625,0.052961953,-0.011253392,0.013367269,0.005298751,-0.049351744,0.0154075315,0.017826091,-0.010382792,0.026728405,-0.016158506,0.01577452,-0.039079886,-0.03747416,0.0334091,-0.06361467,-0.03193667,-0.03682645,-0.030396886,0.010320552,-0.0017340438,0.018339353,0.007722425,0.016667679,-0.008021997,-0.029646423,-0.029182239,0.043044366,0.061386786,0.03198166,-0.04388685,0.040541455,0.08913353,0.022309454,0.017422233,-0.0422438,0.021734336,0.018617455,-0.013369314,-0.01319908,0.0023517201,0.03616698,-0.003907733,-0.033777047,-0.030296689,-0.028426152,0.093669035,0.019829037,0.0072377925,0.0032692247,0.02381243,0.067678824,-0.06354821,0.0012851964,0.013763461,0.01804796,0.021564102,-0.032766372,0.026896082,0.05188635,0.04487247,-0.01867011,-0.054946233,-0.0073840003,0.020571323,0.00518066,0.036557548,-0.052077547,-0.021460837,-0.0018143047,0.049579747,-0.02707603,-0.050322544,0.0034252733,0.011760007,0.019584164,-0.006457677,-0.02536857,-0.005703123,-0.004367827,0.010271346,-0.011497082,-0.010285149,-0.0069494667,0.002530007,-0.011300169,0.06799374,-0.0113857975,-0.03357665,-0.077262074,0.007968576,0.019559115,-0.04039697,0.0016036837,0.008964679,0.044074975,-0.05926217,0.04387458,0.0035928243,-0.012044243,-0.024732618,-0.047880467,-0.02060621,-0.059945155,-0.030245056,0.045898993,0.0063436762,0.011432829,0.050852675,-0.0020218582,0.018352134,-0.040799107,0.015754646,0.006608997,-0.060881447,0.008332816,0.0062782406,0.034916032,0.039505985,-0.014746018,-0.011868896,0.033604257,-0.041085385,-0.01710528,-0.022992311,0.0063901967,0.0137164295,-0.050959006,0.03234973,-0.0067664515,-0.0325808,0.014272313,0.04874135,-0.03401834,-0.025495734,-0.0013352955,-0.033116557,-0.041790865,0.016093582,-0.033482075,0.027487047,-0.02244646,-0.022878949,-0.01767784,-0.0015666207,-0.0029796849,0.04910125,-0.0055420897,0.028086193,-0.0499785,0.032403667,-0.0155152,0.01746722,0.016596107,-0.034127742,-0.031635564,0.025426337,0.016697839,0.023956591,0.019805266,0.0042410456,-0.02450666,0.0097488845,-0.0064137126,0.015365851,0.024264345,-0.04893357,-0.009872087,-0.02688049,-0.03483271,0.021509914,0.0072352365,0.025336873,0.005234849,-0.011044304,-0.00027196677,-0.043976437,0.030803816,0.033057254,-0.004693983,-0.027405253,-0.045539096,0.032564443,0.053763535,0.014785382,0.048113577,0.020976204,0.023192834,-0.019800408,0.06428027,-0.021076402,-0.032018464,-0.04582167,-0.030910147,-0.013647415,0.025893716,0.015811903,0.053321846,0.028278409,0.0015838741,0.00883892,-0.0009263229,0.0004866774,0.05543112,0.030084023,0.04474313,-0.026106765,0.013783654,-0.049833726,-0.010106736,-0.00915434,0.017523453,-0.026811222,0.01919385,0.049415138,-0.015538913,0.042950302,0.022956654,-0.0020714463,0.01827665,0.006191845,0.043267254,0.019753376,0.050571505,0.03595176,0.060098525,0.050401784,-0.020813638,-0.036842298,0.024825659,-0.040205073,0.05645921,-0.0037574358,-0.010054336,-0.013209814,0.0062041143,-0.0039148903,0.0002433387,0.043257028,0.00089207146,0.0018056141,-0.020540647,-0.010748311,-0.027192332,0.050644096,-0.00025918637,-0.048334423,-0.0016849671,-0.008984105,-0.013302345,-0.051861815,-0.0021880034,-0.040690728,-0.01694987,0.02702491,-0.042674247,0.0155818565,0.029285505,0.04542254,0.06674433,-0.04792456,0.06557262,0.051698226,0.007655967,-0.016400823,0.03461953,-0.007993369,-0.020049881,-0.039463807,-0.019821879,0.047087826,0.010334737,-0.023829684,0.0025724375,0.019001376,0.0012584215,0.02417437,-0.044838734,0.015700458,-0.026284667,-0.04374422,0.01997013,0.052808583,-0.014198506,-0.07025126,-0.04797555,-0.02776617,-0.044481393,0.0175439,0.0072919815,-0.015562302,-0.0016507156,-0.019457895,0.01617282,0.01238369,0.019074481,-0.007774569,-0.0066785226,-0.018352134,-0.005056946,0.018303568,-0.0025765274,0.015078819,-0.013189366,0.014625243,-0.04477432,0.013252373,-0.008416656,0.008484136,0.0019528442,-0.037243087,0.013534437,0.009751952,0.0027339817,-0.017859323,-0.0075813294,0.0020622443,-0.013255824,0.019352583,0.037768617,0.047617607,-0.0027564752,0.0034348585,-0.04124284,-0.021718267,0.0043540243,-0.015136076,-0.008844032,-0.0026312275,-0.048650358,0.013992997,-0.017205477,0.022118514,0.0122896265,0.02600593,0.018972239,0.043923657,-0.007629895,-0.017259922,-0.056315526,0.009079192,-0.030684192,0.028791158,-0.0062933215,0.042986855,0.016223943,-0.05588815,0.021291114,0.025314894,0.10052137,0.008706003,0.050000988,0.009236646,-0.05483479,0.0041791885,0.0313682,0.036140908,-0.018139979,-0.0032135022,-0.013247133,-0.042318437,-0.024460651,-0.033391334,-0.04453098,-0.050476417,0.04005324,-0.047203872,-0.020690946,0.026538743,-0.009276009,0.023522059,-0.012498202,-0.04614642,-0.028074035,-0.053193405,0.04254951,-0.0033668668,-0.049313404,-0.013155625,-0.0013475646,0.027064783,0.06420461,0.002452813,-0.018925207,-0.0023751084,0.028977752,-0.049726978,0.050242282,0.0032206592,0.025278596,0.019804496,-0.025945222,-0.041277602,0.027434902,0.025171751,0.010347007,0.002731937,0.0045273267,0.0064203585,-0.051408876,-0.024255909,-0.0078011174,-0.0070501766,-0.01191695,-0.066314906,-0.014550478,0.025785211,0.028707832,-0.026015768,-0.008917647,-0.026669102,-7.1570204e-05,0.024387036,-0.0058738687,-0.006950489,0.024629353,-0.012962386,-0.0028842792,0.055590108,-0.026420651,0.018878175,-0.016716754,-0.030030858,-0.008877773,0.007853297,0.036255162,0.00930157,0.03351428,0.0075271404,0.06774784,0.0064673903,-0.0073584397,0.008330772,-0.0023106951,-0.0021092761,0.004569246,-0.0043330644,0.016067766,-0.012010502,-0.046815094,0.0048463256,0.050246373,0.015702503,-0.06350526,-0.02375824,-0.035571415,0.01654703,-0.023637595,0.025651785,-0.010070822,-0.009455446,-0.06202887,-0.0016806218,-0.001237142,0.017966166,-0.019769223,0.039183665,0.00864159,0.0029238984,-0.012809021,0.064183645,0.010295886,-0.061697096,-0.021052375,-0.0313774,-0.030299244,0.069438435,-0.0039501637,0.04102404,-0.03330775,-0.025860943,0.026914677,0.010089354,0.027668018,-0.0025110918,0.051379226,0.024740798,-0.06795488,0.014791388,0.014185982,-0.046581976,0.035137393,-0.0557537,0.0046970504,-0.044433594,-0.012968522,-0.0047543067,0.0077510527,-0.0515101,-0.06737823,0.00030979674,0.023524102,-0.03051958,0.057743862,0.016459102,-0.017256342,-0.0067787208,0.03654579,-0.038003776,-0.011423882,-0.00055006816,0.04262261,-0.018032623,-0.0034732,-0.012492067,0.006392242,0.025808215,0.0004807984,-0.0680694,0.015105402,-0.014124891,0.03821235,0.010451295,-0.007911575,0.030180132,-0.039257277,0.010379724,0.009764221,0.013260936,-0.05248141,0.016200427,0.010342406,0.07838318,-0.010057659,0.001653783,-0.031371266,0.019390669,-0.009491615,0.041396204,0.024715235,-0.048814967,0.096111625,-0.052215576,-0.0020085666,-0.02445554,0.006789968,0.0058830706,0.017202921,-0.013094663,0.048569586,0.032701448,3.8772516e-05,-0.02126504,0.027400652,-0.009565868,-0.0053892364,0.01261476,-0.019761557,-0.006925951,0.018467158,-0.034340408,0.013062073,0.0002566303,0.048610482,0.005797953,0.0047405036,-0.008131398,0.023506723,-0.017354751,0.0018812739,-0.01361163,0.015575977,-0.0008097657,0.0171633,0.013775092,-0.0014007312,-0.006860515,0.025406145,0.011163929,-0.03324538,0.024363775,-0.013170962,-0.0069637806,-0.026264071,-0.02879739,0.007780448,-0.025888987,0.025115006,-0.017898684,-0.034486614,-0.03266873,0.004371917,0.0062429667,0.021325877,0.019125601,-0.014963284,-0.011477816,-0.030376438,0.014382544,0.038034454,-0.009664021,-0.027282562,-0.0276854,-0.017844496,0.0024246962,0.035725307,-0.03228174,0.038901474,0.02582202,-0.008016885,-0.005626185,0.022791531,-0.008848122,0.021965917,-0.027011616,-0.048677962,-0.021697912,-0.046864167,-0.021682704,-0.000817434,0.01525161,-0.0011757961,0.021613946,0.0110064745,-0.050957985,-0.03125164,-0.032712694,-0.0052882712,0.04587062,-0.0016215764,-0.010044367,0.010833684,0.017050067,0.023303257,-0.0209486,0.025442185,0.0036853543,-0.019391434,0.002190048,0.018150203,-0.002879167,-0.018061252,0.0036459907,-0.050189115,-0.030484818,-0.022679577,-0.025239743,-0.021008156,0.022636633,-0.03685201,0.00033305705,0.018898623,-0.01106322,-0.007355372,0.008015863,0.04340426,-0.017851654,0.00872134,0.006045893,0.036746185,0.018887887,-0.063530825,-0.0058878637,0.016081825,-0.007934068,-0.044667985,0.0038913742,0.064229146,-0.020884186,0.031219434,0.05759561,0.0050201383,0.005444448,0.003826961,0.015240363,-0.01358198,-0.02016644,-0.0048483703,-0.036384247,-0.014924432,0.018244267,-0.023700984,-0.038154077,-0.054875944,0.087904565,0.004517102,0.018487606,-0.03470746,0.034873094,0.034075595,-0.031238606,0.007449691,0.004645673,-0.008137532,-0.028329533,0.05731687,0.018567868,-0.0119959,0.04726445,-0.020116339,-0.04911505,-0.01165853,-0.019134805,-0.0005036753,-0.020743089,-0.01549904,0.04221415,0.018334752,0.023104906,0.014037473,0.017208545,-0.0008731565,-0.009353204,-0.031897817,0.013166873,-0.025789812,0.017259665,-0.008792911,-0.04358421,-0.021070268,0.013049292,0.057654914,0.031167034,-0.0070052533,-0.0064857937,-0.015442804,0.0014835481,0.05601749,-0.009610856,-0.04753693,-0.06287135,-0.001746313,-0.022628453,-0.018045915,0.033015337,0.019377122,0.010852088,-0.012837138,-0.008718274,0.0058002537,0.0015229117,0.020918053,-0.0053912816,0.045724157,-0.0016399801,0.023211751,-0.016892614,0.03633517,-0.0036511829,-0.0057245935,-0.002694107,-0.009992223,-0.016389577]'::vector) AS cosine_similarity
    FROM MEMORY
    ORDER BY cosine_similarity DESC
    LIMIT 5;

"""

import boto3
import psycopg2
import json

from dotenv import load_dotenv

load_dotenv("../../.env")

# Create a Bedrock Runtime client in the AWS Region you want to use.
client = boto3.client("bedrock-runtime", region_name="us-east-1")

# Set the model ID, e.g., Amazon Nova Lite.
model_id = "amazon.titan-embed-text-v2:0" 

# vector procedure
message = "I work at Dock as an architect and I am Eliezer Antunes"

# invoke model
response = None
try:
    response = client.invoke_model(
        body=json.dumps({
            "inputText": message,
            "dimensions": 1024  # valid: 256, 512, 1024
        }),
        modelId=model_id,
        contentType="application/json",
        accept="application/json"
    )

    # Parse the response and extract the embedding
    response_body = json.loads(response["body"].read())
    response_vector_data = response_body["embedding"]
    print(f"Vector length: {len(response_vector_data)}")

except Exception as e:
    print(f"Error invoking the model: {e}")

# save vector data
conn = psycopg2.connect(
    dbname="postgres",
    user="postgres",
    password="postgres",
    host="localhost",
    port=5433,
)
cur = conn.cursor()

# Insert into pgvector table
user_id = 'test-01'
cur.execute(
    "INSERT INTO MEMORY (user_id, message, vector_data) VALUES (%s, %s, %s)",
    (user_id, message, response_vector_data),
)

conn.commit()
cur.close()
conn.close()
